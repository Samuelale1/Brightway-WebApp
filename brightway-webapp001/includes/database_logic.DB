
CREATE FROM DATATBASE IF NOT EXISTS BrightwayData;

USE BrightwayData;

create TABLE if not exists Users(
    id int AUTO_INCREMENT primary Key,
    name Varchar(100),
    email varchar(100),
    password TEXT,
    role ENUM ('admin','salesperson','customer') NOT NULL DEFAULT 'customer';
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE IF NOT EXISTS products (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    price DECIMAL(10,2) NOT NULL,
    category VARCHAR(100),
    image VARCHAR(255), -- new column for image filename/path
    available BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

ALTER TABLE products
ADD COLUMN added_by INT,
ADD FOREIGN KEY (added_by) REFERENCES users(id) ON DELETE SET NULL;

ALTER TABLE products
ADD COLUMN quantity INT DEFAULT 0;

ALTER TABLE products 
ADD COLUMN created_by INT NOT NULL,
ADD CONSTRAINT fk_created_by FOREIGN KEY (created_by) REFERENCES users(id);

ALTER TABLE products 
ADD COLUMN updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP;

ALTER TABLE products 
ADD COLUMN deleted_at DATETIME DEFAULT NULL ;



CREATE TABLE IF NOT EXISTS ORDERS(      
    id INT AUTO_INCREMENT Primary Key,
    customer_id INT,
    salesperson_id INT,
    delivery_person varchar(100),
    status ENUM( 'pending','delivered') NOT NULL DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    Foreign Key (customer_id) References Users(id),
    Foreign Key (salesperson_id) References Users(id),

);

CREATE TABLE audit_logs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    action VARCHAR(100),
    target_type VARCHAR(50),  -- e.g. 'product', 'order'
    target_id INT,            -- the ID of the product or order affected
    description TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
# adds audit logs to allow me know when and where things happen

# create a link to the datatbase 
# this synthax is written in php
$host = 'localhost';
$user='root';
$password='';
$db= 'BrightwayData';

$conn= mysqli_connect($host,$user,$password,$db);

if (!$conn){
        die("connection Failed".mysqli_connect_error());
}

