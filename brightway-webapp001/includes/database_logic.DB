
CREATE FROM DATATBASE IF NOT EXISTS BrightwayData;

USE BrightwayData;

create TABLE if not exists Users(
    id int AUTO_INCREMENT primary Key,
    name Varchar(100),
    email varchar(100),
    password TEXT,
    role ENUM ('admin','salesperson','customer') NOT NULL DEFAULT 'customer';
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE IF NOT EXISTS products (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    price DECIMAL(10,2) NOT NULL,
    category VARCHAR(100),
    image VARCHAR(255), -- new column for image filename/path
    available BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

ALTER TABLE products
ADD COLUMN added_by INT,
ADD FOREIGN KEY (added_by) REFERENCES users(id) ON DELETE SET NULL;

ALTER TABLE products
ADD COLUMN quantity INT DEFAULT 0;

ALTER TABLE products 
ADD COLUMN created_by INT NOT NULL,
ADD CONSTRAINT fk_created_by FOREIGN KEY (created_by) REFERENCES users(id);

ALTER TABLE products 
ADD COLUMN updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP;

ALTER TABLE products 
ADD COLUMN deleted_at DATETIME DEFAULT NULL ;



CREATE TABLE orders (
    id INT AUTO_INCREMENT PRIMARY KEY,
    customer_id INT NOT NULL,
    total_price DECIMAL(10,2) NOT NULL,
    payment_method ENUM('delivery', 'online') NOT NULL,
    delivery_name VARCHAR(100) DEFAULT NULL,
    delivery_phone VARCHAR(20) DEFAULT NULL,
    sent_out_time DATETIME DEFAULT NULL,
    status ENUM('pending', 'paid', 'shipped', 'delivered') DEFAULT 'pending',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (customer_id) REFERENCES users(id)
);



CREATE TABLE order_items (
    id INT AUTO_INCREMENT PRIMARY KEY,
    customer_id INT NOT NULL,
    product_id INT NOT NULL,
    quantity INT NOT NULL DEFAULT 1,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    deleted_at DATETIME DEFAULT NULL,
    FOREIGN KEY (customer_id) REFERENCES users(id),
    FOREIGN KEY (product_id) REFERENCES products(id)
);



CREATE TABLE order_logs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    order_id INT NOT NULL,
    action VARCHAR(255),
    performed_by INT,
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (order_id) REFERENCES orders(id),
    FOREIGN KEY (performed_by) REFERENCES users(id)
);


CREATE TABLE audit_logs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    action VARCHAR(100),
    target_type VARCHAR(50),  -- e.g. 'product', 'order'
    target_id INT,            -- the ID of the product or order affected
    description TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
# adds audit logs to allow me know when and where things happen

# create a link to the datatbase 
# this synthax is written in php
$host = 'localhost';
$user='root';
$password='';
$db= 'BrightwayData';

$conn= mysqli_connect($host,$user,$password,$db);

if (!$conn){
        die("connection Failed".mysqli_connect_error());
}

